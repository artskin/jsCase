<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
  <meta name="renderer" content="webkit">
  <title>Canvas 绘图</title>
  <meta name="description" content="首页描述"/>
  <meta name="keywords" content="首页关键词"/>
  <meta name="author" content="Web Layout:amu"/>
  <meta name="format-detection" content="telephone=no,date=no,address=no,email=no,url=no"/>
  <style>
    html{
      background: #e1e6e9;
    }
    body{
      /* display: flex;
      justify-content: center; */
      padding: 10px;
      margin: 0;
      width: 80%;
      margin: 0 auto;
      max-width: 1000px;
      background: white;
    }
    h1{text-align: center;border-bottom: 2px gray solid;padding-bottom: 20px;}
  　#block{
      /* background-color: #ccc;
      border:3px solid #ccc; */
      width: 100%;
      height: 100%;
    }
    #canvas{position: absolute;background: rgba(0,0,0,.2);}
    #canvas2{border: 1px seagreen dashed;}
    #canvas2:hover{cursor :url(assets/images/draw.ico),auto;}
    .my-canvas{
      width: 500px;
      height: 300px;
    }
  </style>
 </head>

<body>

  <h1>Canvas 绘图</h1>

  <h2>案例二：绘制4个线段</h2>
  <div id="block">
    <canvas id="canvas"></canvas>
    <img id="video" width="60%" src="assets/images/map.png" alt="">
  </div>

  <button onclick="previewHumanBody(true)">预览</button>
  <button onclick="previewHumanBody(false)">禁用预览</button>
  <br>
  <canvas class="my-canvas"></canvas>
</body>
<script>
  let videoDom=document.getElementById("video");
  let canvas=document.getElementById("canvas");
  let ctx=canvas.getContext("2d");
  let start = {x:351,y:385},end={x:503,y:520};
  let humanBodyArray = [[4,105],[141,269],[408,623],[814,1071]]

  videoDom.onload = ()=>{
    let scaleX = videoDom.width/originalVideo.width;
    let scaleY = videoDom.height/originalVideo.height;
    let scale ={
      x:videoDom.width/originalVideo.width,
      y:videoDom.height/originalVideo.height
    }
    canvas.width = videoDom.width;
    canvas.height = videoDom.height;
    //drawLine(start,end,scaleX,scaleY)
    previewHumanBody(true,scale)
  }
    
  let originalVideo = {
    width:1407,
    height:1002
  }

  window.onresize = ()=>{
    let scaleX = videoDom.width/originalVideo.width;
    let scaleY = videoDom.height/originalVideo.height;
    canvas.width = videoDom.width;
    canvas.height = videoDom.height;
      
    //drawLine(start,end,scaleX,scaleY)
  }

  function drawLine(start,end,scaleX,scaleY){
    ctx.clearRect(0,0,1000,1000)
    ctx.beginPath();
    ctx.scale(scaleX,scaleY)
    ctx.moveTo(start.x,start.y);
    
    ctx.lineTo(end.x,end.y);
    
    ctx.closePath();
    
    ctx.lineWidth = 2;
    ctx.setLineDash([5,15]);
    ctx.strokeStyle = "red"
    ctx.stroke();
  }
  
  function poly (num){
    let r = 100;
    let a = 2 * Math.PI / num;
    ctx.beginPath();
    ctx.moveTo(150+r,150);
    for(let i=0;i < num;i++){
      let x = 150 + r * Math.cos(a * i);
      let y = 150 + r * Math.sin(a * i);
      ctx.lineTo(x,y);
    }
    ctx.closePath();
    ctx.stroke();
  }
  poly(8);


  function previewHumanBody(show,scale){
    ctx.clearRect(0,0,1000,1000)
    if(show){
      humanBodyArray.forEach((item) => {
        let pointX = Math.floor(Math.random()*(canvas.width - 1 + 1) + 1)
        let pointObj = {
          start:{
            x:pointX,
            y:item[0]
          },
          end:{
            x:pointX,
            y:item[1]
          }
        }
        insertLines(pointObj.start,pointObj.end,"#cc0000",scale);
      });
    }
  }
  
  function insertLines(startPoint,endPoint,color,scale){
    console.log(startPoint,endPoint,color,scale)
    ctx.beginPath();
    //ctx.scale(scale.x,scale.y)
    ctx.moveTo(startPoint.x, startPoint.y);
    ctx.lineTo(endPoint.x, endPoint.y);
    ctx.strokeStyle = color;
    ctx.lineWidth = 6;
    ctx.lineCap="round";
    ctx.stroke();
  }
  
  function setupCanvas(canvas) {
    // Get the device pixel ratio, falling back to 1.
    var dpr = window.devicePixelRatio || 1;
    // Get the size of the canvas in CSS pixels.
    var rect = canvas.getBoundingClientRect();
    console.log(rect)
    // Give the canvas pixel dimensions of their CSS
    // size * the device pixel ratio.
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    var ctx = canvas.getContext('2d');
    // Scale all drawing operations by the dpr, so you
    // don't have to worry about the difference.
    ctx.scale(dpr, dpr);
    return ctx;
  }

  // Now this line will be the same size on the page
  // but will look sharper on high-DPI devices!
  var ctxP = setupCanvas(document.querySelector('.my-canvas'));
  ctxP.lineWidth = 5;
  ctxP.beginPath();
  ctxP.moveTo(10, 10);
  ctxP.lineTo(10, 200);
  ctxP.stroke();

</script>
</html>