<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
  <meta name="renderer" content="webkit">
  <title>商品*期免息价值计算</title>
  <meta name="description" content="首页描述"/>
  <meta name="keywords" content="首页关键词"/>
  <meta name="author" content="Web Layout:amu"/>
  <!-- <link data-n-head="ssr" href="/assets/manifest.json" rel="manifest"> -->
  <meta name="format-detection" content="telephone=no,date=no,address=no,email=no,url=no"/>
  <link rel="stylesheet" href="../src/style/base.css?v=1">
  <style>
    body.paper{margin-top: 2%;width: 88%;margin-bottom: 2%;max-width: 500px;}
    h3{
      margin-top: 0.2em;
    }
    .center{
      text-align: center;
    }
    form label{
      display: inline-block;
      width: 100px;
      text-align: right;
    }
    form input{width: 52%;}
    ul{
      list-style: none;
      padding-left: .2em;
      margin-left: 0;
    }
    /* .result{display: none;} */
    ul li em{display: inline-block;width:2em;text-align: center;font-size: 12px;}
    #app strong{color: green;}
    .gray{
      color: #ccc;
      font-size: 12px;
    }
    .btn-blue{width: 55%;}
  </style>
</head>
<body class="paper">
  <h3 class="center">vue3 - Reactivity show</h3>
<hr>
  <p>
    <label for="price">price</label>
    <input type="number" name="price" id="input-price">
  </p>
  <p>
    <label for="discount">discount</label>
    <input type="number" name="discount" id="input-discount">
  </p>
<hr>
  <div class="result">

  </div>
<!-- <script src="./lib/3.0.0-rc.1.vue.global.js"></script> -->
<!-- <script src="../lib/vue@3.0.5.global.js"></script> -->
<script src="./reactivity.js"></script>
<script>
  /// 应用代码
  
  function effect(eff){
    //console.log(eff)
    activeEffect = eff
    activeEffect()
    activeEffect = null
  }

  let total = 0,
      baseData = {
        price:5,
        discount:2
      }
  let product = reactive(baseData)
  let salePrice = ref(0)

  $('input').addEventListener('change',updateValue)
  
  function updateValue(e){
    //console.log('d')
    //console.log('updateValue-Before',e)
    
      product[e.target.name] = e.target.value
    
    
    //console.log('updateValue=After',e.target.name,e.target.value)
  }
  //
  //debugger
  // let effect = () =>{ 
  //   //total = product.price * product.discount
  //   total = salePrice.value * product.discount
  // }
  // effect()
  
  
  //effect()
  //console.log(salePrice.value)

  let resultEl = $('.result'),
      priceEl = $('#input-price'),
      discountEl = $('#input-discount')
      
  function init(){
    //console.trace()
    priceEl.value = product.price
    discountEl.value = product.discount
    //resultEl.innerHTML = total
    
  }

  function render(){
    //console.trace()
    console.log(`${product.price * 0.9}*${product.discount} => ${total}`)
    init()
  }

  effect(() => {
    salePrice.value = product.price * 0.9
  })

  effect(() => {
    total = salePrice.value * product.discount
    render()
  })

//log==========
// console.log(`Before updated discount total (should be 9)= ${total} salePrice (should be 4.5)= ${salePrice.value}`)

// product.discount = 3
// console.log(`After updated discount total (should be 13.5)= ${total} salePrice (should be 4.5)= ${salePrice.value}`)

//product.price = 10

//console.log( `After updated price total (should be 27)= ${total} salePrice (should be 9)= ${salePrice.value}`)
</script>
</body>
</html>